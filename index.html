<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Samuel Ciscato - CV Twin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Sora:wght@500;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      color-scheme: light;
      --bg: #f5f5f7;
      --bg-card: #ffffff;
      --border-subtle: #e1e1e5;
      --text-main: #111111;
      --text-muted: #666666;
      --accent: #1b4ae8;
      --accent-soft: #e0e7ff;
      --shadow-soft: 0 14px 30px rgba(15, 23, 42, 0.12);
      --radius-lg: 16px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: radial-gradient(circle at top, #f3f4ff 0, #f5f5f7 40%, #f5f5f7 100%);
      color: var(--text-main);
    }

    h1, h2, h3,
    .hero-title,
    .sidebar-section-title {
      font-family: "Sora", "Inter", system-ui, sans-serif;
    }

    .page {
      max-width: 1120px;
      margin: 32px auto 40px;
      padding: 0 20px;
      display: grid;
      grid-template-columns: 280px minmax(0, 1fr);
      grid-auto-rows: auto;
      gap: 24px;
    }

    @media (max-width: 840px) {
      .page {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    /* Hero wide */

    .hero-card {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-soft);
      padding: 18px 22px 18px;
      position: relative;
      overflow: hidden;
      grid-column: 1 / -1;
    }

    .hero-layout {
      display: grid;
      grid-template-columns: auto minmax(0, 1fr);
      gap: 20px;
      align-items: flex-start;
    }

    @media (max-width: 720px) {
      .hero-layout {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .hero-identity {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .avatar {
      width: 64px;
      height: 64px;
      border-radius: 50%;
      background: linear-gradient(135deg, #d6defa, #f2f3ff);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 26px;
      font-weight: 600;
      color: #1c2a5a;
      flex-shrink: 0;
    }

    .name-texts {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .hero-name {
      margin: 0;
      font-size: 22px;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      font-weight: 600;
    }

    .role {
      font-size: 11px;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: var(--text-muted);
    }

    .badge-twin {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      background: var(--accent-soft);
      color: #1c2a5a;
      font-size: 11px;
      font-weight: 500;
      margin-top: 6px;
      align-self: flex-start;
    }

    .badge-dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: var(--accent);
    }

    .hero-eyebrow {
      font-size: 11px;
      letter-spacing: 0.22em;
      text-transform: uppercase;
      color: var(--text-muted);
      margin-bottom: 6px;
    }

    .hero-title {
      margin: 0 0 6px;
      font-size: 19px;
      font-weight: 600;
    }

    .hero-sub {
      margin: 0;
      font-size: 13px;
      color: var(--text-muted);
      line-height: 1.6;
      max-width: 640px;
    }

    .hero-quick-questions {
      margin-top: 12px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .hero-quick-btn {
      border-radius: 999px;
      border: 1px solid #ddddea;
      background: #f7f7fb;
      font-size: 11px;
      padding: 5px 10px;
      cursor: pointer;
      transition: background 0.15s ease, border-color 0.15s ease, transform 0.08s ease;
      white-space: nowrap;
    }

    .hero-quick-btn:hover {
      background: #e8ebff;
      border-color: var(--accent);
      transform: translateY(-0.5px);
    }

    .hero-diagram {
      position: absolute;
      right: -30px;
      top: -10px;
      width: 180px;
      height: 120px;
      pointer-events: none;
      opacity: 0.5;
    }

    /* Sidebar */

    .sidebar {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      padding: 22px 22px;
      border: 1px solid var(--border-subtle);
      display: flex;
      flex-direction: column;
      gap: 20px;
      box-shadow: var(--shadow-soft);
    }

    .sidebar-section-title {
      font-size: 11px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: var(--text-muted);
      margin: 0 0 10px;
    }

    .sidebar-text {
      font-size: 13px;
      line-height: 1.55;
      color: var(--text-main);
    }

    .sidebar-card {
      border-radius: 12px;
      border: 1px solid #ebebf0;
      padding: 12px 12px 14px;
      background: linear-gradient(135deg, #fafafa, #ffffff);
    }

    .cv-preview-box {
      border-radius: 10px;
      border: 1px dashed #c4c4cf;
      background: #f9f9fb;
      padding: 16px;
      font-size: 12px;
      text-align: center;
      color: var(--text-muted);
    }

    .sidebar-buttons {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 10px;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 9px 12px;
      border-radius: 999px;
      border: 1px solid transparent;
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      text-decoration: none;
      transition: background 0.15s ease, color 0.15s ease, border-color 0.15s ease, transform 0.08s ease;
    }

    .btn-primary {
      background: var(--accent);
      color: #ffffff;
      box-shadow: 0 10px 22px rgba(27, 74, 232, 0.38);
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 14px 26px rgba(27, 74, 232, 0.5);
    }

    .btn-ghost {
      background: #ffffff;
      color: var(--text-main);
      border-color: #d3d3dd;
    }

    .btn-ghost:hover {
      background: #f3f3f8;
    }

    .sidebar-contact {
      font-size: 11px;
      color: var(--text-muted);
      line-height: 1.5;
    }

    .sidebar-contact a {
      color: inherit;
      text-decoration: none;
    }

    .sidebar-contact a:hover {
      text-decoration: underline;
    }

    .linkedin-card {
      margin-top: 8px;
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 9px 10px;
      border-radius: 999px;
      border: 1px solid #d3d3dd;
      background: #ffffff;
      cursor: pointer;
      text-decoration: none;
      color: var(--text-main);
      font-size: 12px;
    }

    .linkedin-logo {
      width: 20px;
      height: 20px;
      border-radius: 4px;
      background: #0a66c2;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #ffffff;
      font-size: 13px;
      font-weight: 700;
    }

    .linkedin-text-main {
      font-weight: 500;
    }

    .linkedin-text-sub {
      font-size: 11px;
      color: var(--text-muted);
    }

    /* Main column */

    .main {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .top-bar {
      display: flex;
      justify-content: flex-end;
      margin-bottom: 6px;
      font-size: 11px;
      color: var(--text-muted);
      gap: 10px;
      align-items: center;
    }

    .lang-switch {
      display: inline-flex;
      border-radius: 999px;
      border: 1px solid #d3d3dd;
      overflow: hidden;
    }

    .lang-btn {
      border: none;
      background: transparent;
      padding: 4px 8px;
      font-size: 11px;
      cursor: pointer;
    }

    .lang-btn.active {
      background: #e5e7ff;
      color: #111111;
      font-weight: 500;
    }

    .qa-card {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-soft);
      padding: 20px 22px 22px;
    }

    .qa-header-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 16px;
      margin-bottom: 14px;
    }

    .qa-title {
      margin: 0;
      font-size: 15px;
      font-weight: 600;
    }

    .qa-caption {
      margin: 0;
      font-size: 12px;
      color: var(--text-muted);
    }

    .qa-form {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 6px;
    }

    .qa-row {
      display: flex;
      gap: 10px;
    }

    @media (max-width: 600px) {
      .qa-row {
        flex-direction: column;
        align-items: stretch;
      }
    }

    textarea {
      width: 100%;
      min-height: 70px;
      resize: vertical;
      padding: 10px 11px;
      border-radius: 10px;
      border: 1px solid #d4d4e2;
      font-family: inherit;
      font-size: 13px;
      line-height: 1.5;
      outline: none;
      transition: border-color 0.15s ease, box-shadow 0.15s ease;
    }

    textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(27, 74, 232, 0.18);
    }

    .qa-submit-btn {
      padding-inline: 18px;
      white-space: nowrap;
      height: 38px;
    }

    .status-text {
      font-size: 12px;
      color: var(--text-muted);
      min-height: 18px;
    }

    .answer-box {
      margin-top: 8px;
      padding: 12px 12px 10px;
      border-radius: 10px;
      border: 1px solid #e2e2ee;
      background: #fafafe;
      font-size: 13px;
      line-height: 1.55;
      white-space: pre-wrap;
    }

    .answer-empty {
      border-style: dashed;
      background: #fcfcff;
      color: #9b9bb3;
    }

    .followup-container {
      margin-top: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: flex-start;
    }

    .followup-label {
      font-size: 11px;
      color: var(--text-muted);
    }

    .followup-btn {
      font-size: 11px;
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px solid #d2d2e2;
      background: #ffffff;
      cursor: pointer;
      max-width: 100%;
      white-space: normal;
      line-height: 1.4;
      text-align: left;
      transition: background 0.15s ease,
                  border-color 0.15s ease,
                  transform 0.08s ease;
    }

    .followup-btn:hover {
      background: #f3f3fb;
      border-color: var(--accent);
      transform: translateY(-0.5px);
    }

    /* Info card */

    .info-card {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-soft);
      padding: 18px 22px 18px;
      grid-column: 1 / -1;
      font-size: 12px;
      line-height: 1.6;
    }

    .info-title {
      margin: 0 0 8px;
      font-size: 14px;
      font-weight: 600;
    }

    .footer-note {
      font-size: 12px;
      color: var(--text-muted);
      line-height: 1.6;
    }

    .footer-note strong {
      font-weight: 600;
    }
  </style>
</head>
<body>
  <main class="page">

    <!-- Hero wide -->
    <section class="hero-card">
      <div class="hero-layout">
        <div class="hero-identity">
          <div class="avatar">S</div>
          <div class="name-texts">
            <h1 class="hero-name">SAMUEL CISCATO</h1>
            <div class="role" id="role-line">
              DIRECTION MARKETING ET E COMMERCE · TRANSFORMATION DIGITALE
            </div>
            <div class="badge-twin">
              <span class="badge-dot"></span>
              <span id="badge-text">Samuel CV Twin</span>
            </div>
          </div>
        </div>

        <div>
          <div class="hero-eyebrow" id="hero-eyebrow">DOSSIER INTERACTIF</div>
          <h2 class="hero-title" id="hero-title">
            Explorer mon parcours avant d echanger en direct
          </h2>
          <p class="hero-sub" id="hero-sub">
            Cet outil vous permet de poser des questions a un agent IA entraine sur mon dossier
            (CV, lettres, profil AssessFirst, questions reponses). Il ne parle pas en mon nom:
            il lit, recoupe et synthetise les informations disponibles, puis vous propose des pistes pour creuser.
          </p>

          <div class="hero-quick-questions" id="hero-quick-questions"></div>
        </div>
      </div>

      <!-- petit diagramme tech discret -->
      <svg class="hero-diagram" viewBox="0 0 200 120" aria-hidden="true">
        <defs>
          <linearGradient id="grad" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0" stop-color="#d7ddff" />
            <stop offset="1" stop-color="#b3c3ff" />
          </linearGradient>
        </defs>
        <circle cx="40" cy="60" r="10" fill="url(#grad)" />
        <circle cx="110" cy="30" r="8" fill="url(#grad)" />
        <circle cx="150" cy="80" r="9" fill="url(#grad)" />
        <circle cx="85" cy="95" r="6" fill="#ffffff" stroke="#c4cdf7" stroke-width="1" />
        <line x1="40" y1="60" x2="110" y2="30" stroke="#c4cdf7" stroke-width="1" />
        <line x1="40" y1="60" x2="150" y2="80" stroke="#c4cdf7" stroke-width="1" />
        <line x1="110" y1="30" x2="150" y2="80" stroke="#c4cdf7" stroke-width="1" />
        <line x1="40" y1="60" x2="85" y2="95" stroke="#c4cdf7" stroke-width="1" />
      </svg>
    </section>

    <!-- Sidebar -->
    <aside class="sidebar">
      <section>
        <h2 class="sidebar-section-title" id="profil-title">PROFIL</h2>
        <p class="sidebar-text" id="profil-text">
          Samuel clarifie des situations complexes pour les traduire en plans de croissance lisibles et utiles pour les equipes.
          Il croise marketing, digital et psychologie cognitive pour aligner clients, operations et direction sur les memes priorites.
        </p>
      </section>

      <section>
        <h2 class="sidebar-section-title" id="cv-title">CV ET DOSSIER</h2>
        <div class="sidebar-card">
          <div class="cv-preview-box" id="cv-preview">
            Apercu CV<br />
            <span style="font-size: 11px;">(remplacez cette zone par une miniature de CV plus tard)</span>
          </div>
          <div class="sidebar-buttons">
            <a href="#" class="btn btn-primary" id="btn-download-cv">Telecharger le CV</a>
            <a href="#" class="btn btn-ghost" id="btn-open-cv">Ouvrir en grand format</a>
          </div>
        </div>
      </section>

      <section>
        <h2 class="sidebar-section-title" id="contact-title">CONTACT</h2>
        <p class="sidebar-contact">
          <span id="contact-email">samuel.ciscato@gmail.com</span><br />
          <span id="contact-phone">+33 6 67 98 00 44</span><br />
          <span id="contact-city">Lyon, France</span><br />
        </p>

        <a
          href="https://linkedin.com/in/samuelciscato"
          target="_blank"
          rel="noreferrer"
          class="linkedin-card"
          id="linkedin-card"
        >
          <div class="linkedin-logo">in</div>
          <div>
            <div class="linkedin-text-main" id="linkedin-main-text">Voir le profil LinkedIn</div>
            <div class="linkedin-text-sub" id="linkedin-sub-text">
              Recommandations et detail des experiences sur LinkedIn.
            </div>
          </div>
        </a>
      </section>
    </aside>

    <!-- Main column -->
    <section class="main">
      <div class="top-bar">
        <span id="lang-label">Langue</span>
        <div class="lang-switch">
          <button class="lang-btn active" data-lang="fr" id="btn-lang-fr">FR</button>
          <button class="lang-btn" data-lang="en" id="btn-lang-en">EN</button>
        </div>
      </div>

      <section class="qa-card">
        <div class="qa-header-row">
          <h3 class="qa-title" id="qa-title">Poser une question a mon dossier</h3>
          <p class="qa-caption" id="qa-caption">
            L agent s appuie uniquement sur les informations presentes dans le dossier.
            Si une information n y apparait pas, il indique simplement qu il ne sait pas.
          </p>
        </div>

        <form id="qa-form" class="qa-form">
          <div class="qa-row">
            <textarea
              id="question-input"
              name="question"
              placeholder="Par exemple: Quels resultats concrets a t il obtenus chez Lyca ?"
            ></textarea>
            <button id="submit-btn" class="btn btn-primary qa-submit-btn" type="submit">
              Poser la question
            </button>
          </div>
          <div class="status-text" id="status-text"></div>
        </form>

        <div id="answer-box" class="answer-box answer-empty">
          Aucune question posee pour le moment. La premiere reponse apparaitra ici.
        </div>

        <div id="followup-container" class="followup-container" style="display:none;">
          <span class="followup-label" id="followup-label">Questions possibles pour creuser :</span>
        </div>
      </section>
    </section>

    <!-- Info card -->
    <section class="info-card">
      <h3 class="info-title" id="info-title">Comment fonctionne ce jumeau IA</h3>
      <p class="footer-note" id="footer-note">
        <!-- Rempli par le script selon la langue -->
      </p>
    </section>
  </main>

  <script>
    // Traductions FR / EN
    const translations = {
      fr: {
        roleLine: "DIRECTION MARKETING ET E COMMERCE · TRANSFORMATION DIGITALE",
        badgeText: "Samuel CV Twin",
        profilTitle: "PROFIL",
        profilText:
          "Samuel clarifie des situations complexes pour les traduire en plans de croissance lisibles et utiles pour les equipes. " +
          "Il croise marketing, digital et psychologie cognitive pour aligner clients, operations et direction sur les memes priorites.",
        cvTitle: "CV ET DOSSIER",
        cvPreview: "Apercu CV<br /><span style=\"font-size: 11px;\">(remplacez cette zone par une miniature de CV plus tard)</span>",
        btnDownload: "Telecharger le CV",
        btnOpen: "Ouvrir en grand format",
        contactTitle: "CONTACT",
        linkedinMain: "Voir le profil LinkedIn",
        linkedinSub: "Recommandations et detail des experiences sur LinkedIn.",
        langLabel: "Langue",
        heroEyebrow: "DOSSIER INTERACTIF",
        heroTitle: "Explorer mon parcours avant d echanger en direct",
        heroSub:
          "Cet outil vous permet de poser des questions a un agent IA entraine sur mon dossier " +
          "(CV, lettres, profil AssessFirst, questions reponses). Il ne parle pas en mon nom: " +
          "il lit, recoupe et synthetise les informations disponibles, puis vous propose des pistes pour creuser.",
        qaTitle: "Poser une question a mon dossier",
        qaCaption:
          "L agent s appuie uniquement sur les informations presentes dans le dossier. " +
          "Si une information n y apparait pas, il indique simplement qu il ne sait pas.",
        placeholder:
          "Par exemple: Quels resultats concrets a t il obtenus chez Lyca ? " +
          "ou Comment gere t il une equipe marketing sous pression ?",
        btnAsk: "Poser la question",
        answerEmpty: "Aucune question posee pour le moment. La premiere reponse apparaitra ici.",
        followupLabel: "Questions possibles pour creuser :",
        infoTitle: "Comment fonctionne ce jumeau IA",
        footer:
          "<strong>Base de travail.</strong> Le jumeau IA s appuie sur un pack de donnees fixe: plusieurs versions de mon CV, " +
          "des lettres de motivation, des reponses RH structurees et des elements de profil de personnalite. " +
          "Le modele lit ces documents, recoupe les informations et produit une synthese adaptee a la question posee.<br /><br />" +
          "<strong>Technologie.</strong> L agent tourne sur le modele GPT 5.1 d OpenAI, deploye via Netlify et pilote par des scenarios Make. " +
          "Il ne invente pas de dates ni de chiffres en dehors de ce qui figure dans le dossier et indique explicitement quand une information manque.<br /><br />" +
          "<strong>Donnees et confidentialite.</strong> Les questions que vous posez peuvent etre enregistreés pour analyser les themes les plus fréquents " +
          "et ameliorer le dispositif. Elles ne sont ni revendues, ni utilisees pour de la publicite ciblee. " +
          "Le jumeau IA ne cree pas d informations nouvelles sur ma vie privee et ne porte pas de jugement sur le fit culturel. " +
          "Pour cela, un echange direct reste indispensable.",
        loading: "En reflexion...",
        emptyQuestion: "Merci de saisir une question avant d envoyer.",
        genericError: "Une erreur est survenue. Vous pouvez reessayer dans un instant.",
        quickExamples: [
          {
            label: "Son experience marketing",
            question: "Pouvez vous resumer son experience en marketing et e commerce ?"
          },
          {
            label: "Management d equipe",
            question: "Comment dirige t il une equipe marketing et digitale dans un contexte de pression ?"
          },
          {
            label: "IA et automatisation",
            question: "Comment utilise t il concretement l IA et l automatisation dans ses missions ?"
          }
        ]
      },
      en: {
        roleLine: "MARKETING AND E COMMERCE LEADERSHIP · DIGITAL TRANSFORMATION",
        badgeText: "Samuel CV Twin",
        profilTitle: "PROFILE",
        profilText:
          "Samuel turns complex situations into clear growth plans that are useful and sustainable for teams. " +
          "He combines marketing, digital and cognitive psychology to align customers, operations and leadership on the same priorities.",
        cvTitle: "CV AND DOSSIER",
        cvPreview:
          "CV preview<br /><span style=\"font-size: 11px;\">(replace this area with a real CV thumbnail later)</span>",
        btnDownload: "Download CV",
        btnOpen: "Open full version",
        contactTitle: "CONTACT",
        linkedinMain: "View LinkedIn profile",
        linkedinSub: "Recommendations and full experience details on LinkedIn.",
        langLabel: "Language",
        heroEyebrow: "INTERACTIVE DOSSIER",
        heroTitle: "Explore my track record before a live conversation",
        heroSub:
          "This tool lets you ask questions to an AI agent trained on my dossier " +
          "(CV, letters, AssessFirst profile, Q and A blocks). It does not speak in my name: " +
          "it reads, cross checks and synthesises the available information, then suggests angles you can dig into.",
        qaTitle: "Ask a question to my dossier",
        qaCaption:
          "The agent only relies on what is present in the dossier. " +
          "If a piece of information is not there, it simply says it does not know.",
        placeholder:
          "For example: What concrete results did he deliver at Lyca? " +
          "or How does he handle a marketing team under pressure?",
        btnAsk: "Ask the question",
        answerEmpty: "No question asked yet. The first answer will appear here.",
        followupLabel: "Follow up questions you could ask:",
        infoTitle: "How this AI twin works",
        footer:
          "<strong>Data set.</strong> The AI twin is based on a fixed pack of documents: several versions of my CV, " +
          "cover letters, structured HR Q and A and personality insights. The model reads these documents, " +
          "cross checks the information and produces a synthesis tailored to the question.<br /><br />" +
          "<strong>Technology.</strong> The agent runs on OpenAI s GPT 5.1 model, deployed on Netlify and orchestrated with Make scenarios. " +
          "It does not invent dates or figures beyond what is present in the dossier and clearly says when a piece of information is missing.<br /><br />" +
          "<strong>Data and privacy.</strong> Questions may be logged to analyse recurring themes and improve the system. " +
          "They are not sold or used for targeted advertising. The AI twin does not create new information about my private life " +
          "and does not judge cultural fit. For that, a direct conversation is still required.",
        loading: "Thinking...",
        emptyQuestion: "Please type a question before sending.",
        genericError: "Something went wrong. You can try again in a moment.",
        quickExamples: [
          {
            label: "Marketing track record",
            question: "Could you summarise his experience in marketing and e commerce?"
          },
          {
            label: "Team leadership",
            question: "How does he lead a marketing and digital team in a high pressure context?"
          },
          {
            label: "AI and automation",
            question: "How does he use AI and automation in his recent projects?"
          }
        ]
      }
    };

    const elements = {
      roleLine: document.getElementById("role-line"),
      badgeText: document.getElementById("badge-text"),
      profilTitle: document.getElementById("profil-title"),
      profilText: document.getElementById("profil-text"),
      cvTitle: document.getElementById("cv-title"),
      cvPreview: document.getElementById("cv-preview"),
      btnDownload: document.getElementById("btn-download-cv"),
      btnOpen: document.getElementById("btn-open-cv"),
      contactTitle: document.getElementById("contact-title"),
      linkedinMain: document.getElementById("linkedin-main-text"),
      linkedinSub: document.getElementById("linkedin-sub-text"),
      langLabel: document.getElementById("lang-label"),
      heroEyebrow: document.getElementById("hero-eyebrow"),
      heroTitle: document.getElementById("hero-title"),
      heroSub: document.getElementById("hero-sub"),
      qaTitle: document.getElementById("qa-title"),
      qaCaption: document.getElementById("qa-caption"),
      questionInput: document.getElementById("question-input"),
      submitBtn: document.getElementById("submit-btn"),
      answerBox: document.getElementById("answer-box"),
      followupLabel: document.getElementById("followup-label"),
      infoTitle: document.getElementById("info-title"),
      footerNote: document.getElementById("footer-note")
    };

    const statusText = document.getElementById("status-text");
    const followupContainer = document.getElementById("followup-container");
    const quickContainer = document.getElementById("hero-quick-questions");

    const langButtons = {
      fr: document.getElementById("btn-lang-fr"),
      en: document.getElementById("btn-lang-en")
    };

    let currentLang = "fr";

    function renderQuickExamples(lang) {
      const t = translations[lang];
      if (!t || !Array.isArray(t.quickExamples)) return;

      quickContainer.innerHTML = "";
      t.quickExamples.forEach((item) => {
        if (!item || typeof item.label !== "string" || typeof item.question !== "string") return;
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "hero-quick-btn";
        btn.textContent = item.label;
        btn.addEventListener("click", () => {
          elements.questionInput.value = item.question;
          document.getElementById("qa-form").dispatchEvent(new Event("submit", { cancelable: true }));
        });
        quickContainer.appendChild(btn);
      });
    }

    function applyLang(lang) {
      const t = translations[lang];
      if (!t) return;

      currentLang = lang;
      localStorage.setItem("cv_twin_lang", lang);

      elements.roleLine.textContent = t.roleLine;
      elements.badgeText.textContent = t.badgeText;
      elements.profilTitle.textContent = t.profilTitle;
      elements.profilText.textContent = t.profilText;
      elements.cvTitle.textContent = t.cvTitle;
      elements.cvPreview.innerHTML = t.cvPreview;
      elements.btnDownload.textContent = t.btnDownload;
      elements.btnOpen.textContent = t.btnOpen;
      elements.contactTitle.textContent = t.contactTitle;
      elements.linkedinMain.textContent = t.linkedinMain;
      elements.linkedinSub.textContent = t.linkedinSub;
      elements.langLabel.textContent = t.langLabel;
      elements.heroEyebrow.textContent = t.heroEyebrow;
      elements.heroTitle.textContent = t.heroTitle;
      elements.heroSub.textContent = t.heroSub;
      elements.qaTitle.textContent = t.qaTitle;
      elements.qaCaption.textContent = t.qaCaption;
      elements.questionInput.placeholder = t.placeholder;
      elements.submitBtn.textContent = t.btnAsk;
      elements.answerBox.textContent = t.answerEmpty;
      elements.answerBox.classList.add("answer-empty");
      elements.followupLabel.textContent = t.followupLabel;
      elements.infoTitle.textContent = t.infoTitle;
      elements.footerNote.innerHTML = t.footer;

      // switch UI
      Object.keys(langButtons).forEach(code => {
        langButtons[code].classList.toggle("active", code === lang);
      });

      // reset status text et followups
      statusText.textContent = "";
      clearFollowups();
      renderQuickExamples(lang);
    }

    function initLang() {
      const stored = localStorage.getItem("cv_twin_lang");
      if (stored && translations[stored]) {
        applyLang(stored);
      } else {
        const navLang = (navigator.language || "en").toLowerCase();
        const defaultLang = navLang.startsWith("fr") ? "fr" : "en";
        applyLang(defaultLang);
      }
    }

    Object.keys(langButtons).forEach(code => {
      langButtons[code].addEventListener("click", () => applyLang(code));
    });

    // Geo function: Lyon vs Paris
    async function initCity() {
      try {
        const res = await fetch("/.netlify/functions/geo");
        if (!res.ok) return;
        const data = await res.json();
        const city = (data.city || "").toLowerCase();
        const contactCity = document.getElementById("contact-city");
        if (!contactCity) return;

        if (city.includes("lyon")) {
          contactCity.textContent = "Lyon, France";
        } else {
          contactCity.textContent = "Paris, France";
        }
      } catch (e) {
        // fallback: keep default value
      }
    }

    // Chat logic
    const form = document.getElementById("qa-form");

    function setLoading(isLoading) {
      const t = translations[currentLang];
      if (isLoading) {
        statusText.textContent = t.loading;
        elements.submitBtn.disabled = true;
        elements.submitBtn.textContent = t.loading;
      } else {
        statusText.textContent = "";
        elements.submitBtn.disabled = false;
        elements.submitBtn.textContent = t.btnAsk;
      }
    }

    function renderAnswer(text) {
      elements.answerBox.classList.remove("answer-empty");
      elements.answerBox.textContent = text;
    }

    function clearFollowups() {
      followupContainer.style.display = "none";
      followupContainer.querySelectorAll(".followup-btn").forEach((btn) => btn.remove());
    }

    // Parse la ligne QUESTIONS_SUIVANTES: ["...", "...", "..."]
    function parseSuggestions(rawText) {
      const match = rawText.match(/QUESTIONS_SUIVANTES:\s*(\[.*\])\s*$/m);
      if (!match) return { mainAnswer: rawText.trim(), suggestions: [] };

      let suggestions = [];
      try {
        suggestions = JSON.parse(match[1]);
      } catch (e) {
        console.error("Impossible de parser QUESTIONS_SUIVANTES", e);
      }

      const mainAnswer = rawText.replace(match[0], "").trim();
      return { mainAnswer, suggestions };
    }

    function renderFollowups(suggestions) {
      clearFollowups();
      if (!Array.isArray(suggestions) || suggestions.length === 0) return;

      followupContainer.style.display = "flex";

      suggestions.slice(0, 3).forEach((q) => {
        if (!q || typeof q !== "string") return;

        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "followup-btn";

        const label =
          q.length > 80
            ? q.slice(0, 77).trimEnd() + "..."
            : q;

        btn.textContent = label;
        btn.title = q;

        btn.addEventListener("click", () => {
          elements.questionInput.value = q;
          form.dispatchEvent(new Event("submit", { cancelable: true }));
        });

        followupContainer.appendChild(btn);
      });
    }

    form.addEventListener("submit", async (event) => {
      event.preventDefault();
      const t = translations[currentLang];
      const question = elements.questionInput.value.trim();
      if (!question) {
        statusText.textContent = t.emptyQuestion;
        return;
      }

      setLoading(true);
      clearFollowups();

      try {
        const response = await fetch("/.netlify/functions/chat", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ question })
        });

        const data = await response.json();
        if (data && typeof data.answer === "string") {
          const { mainAnswer, suggestions } = parseSuggestions(data.answer);
          renderAnswer(mainAnswer);
          renderFollowups(suggestions);
        } else {
          renderAnswer(t.genericError);
        }
      } catch (error) {
        console.error(error);
        renderAnswer(translations[currentLang].genericError);
      } finally {
        setLoading(false);
      }
    });

    // Init
    initLang();
    initCity();
  </script>
</body>
</html>
