<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Samuel Ciscato - CV Twin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      color-scheme: light;
      --bg: #050816;
      --bg-card: #050816;
      --border-subtle: #1f2933;
      --text-main: #f9fafb;
      --text-muted: #9ca3af;
      --accent: #38bdf8;
      --accent-soft: rgba(56, 189, 248, 0.16);
      --shadow-soft: 0 20px 40px rgba(15, 23, 42, 0.55);
      --radius-lg: 20px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Montserrat", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background:
        radial-gradient(circle at top left, #0b1120 0, #020617 45%, #020617 100%);
      color: var(--text-main);
    }

    .page {
      max-width: 1120px;
      margin: 32px auto 40px;
      padding: 0 20px 40px;
      display: grid;
      grid-template-columns: 280px minmax(0, 1fr);
      column-gap: 24px;
      row-gap: 24px;
    }

    @media (max-width: 900px) {
      .page {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    /* Sidebar */

    .sidebar {
      background: rgba(15, 23, 42, 0.9);
      border-radius: 18px;
      padding: 20px 18px 22px;
      border: 1px solid var(--border-subtle);
      display: flex;
      flex-direction: column;
      gap: 18px;
      box-shadow: 0 14px 30px rgba(0, 0, 0, 0.45);
    }

    .name-block {
      border-bottom: 1px solid var(--border-subtle);
      padding-bottom: 14px;
      display: flex;
      gap: 12px;
    }

    .name-texts {
      flex: 1;
    }

    .name-block h1 {
      margin: 0 0 4px;
      font-size: 20px;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      font-weight: 600;
    }

    .name-block .role {
      font-size: 10px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: var(--text-muted);
    }

    .badge-twin {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 3px 9px;
      border-radius: 999px;
      background: var(--accent-soft);
      color: #e0f2fe;
      font-size: 10px;
      font-weight: 500;
      margin-top: 8px;
      border: 1px solid rgba(56, 189, 248, 0.35);
    }

    .badge-dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: var(--accent);
      box-shadow: 0 0 6px rgba(56, 189, 248, 0.9);
    }

    .avatar {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background:
        radial-gradient(circle at 30% 25%, #f9fafb 0, #e5e7eb 40%, #111827 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      font-weight: 600;
      color: #020617;
      box-shadow: 0 0 0 3px #020617, 0 0 0 5px rgba(56, 189, 248, 0.7);
    }

    .sidebar-section-title {
      font-size: 11px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      color: var(--text-muted);
      margin: 0 0 8px;
    }

    .sidebar-text {
      font-size: 13px;
      line-height: 1.55;
      color: #e5e7eb;
    }

    .sidebar-card {
      border-radius: 14px;
      border: 1px solid #1f2937;
      padding: 11px 11px 13px;
      background: radial-gradient(circle at top left, #0b1120 0, #020617 55%, #020617 100%);
    }

    /* CV preview */

    .cv-preview-box {
      border-radius: 10px;
      border: 1px dashed #4b5563;
      background:
        linear-gradient(135deg, rgba(15, 23, 42, 0.6), rgba(15, 23, 42, 0.95));
      padding: 14px;
      font-size: 11px;
      text-align: center;
      color: var(--text-muted);
      min-height: 90px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .sidebar-buttons {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 10px;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 9px 12px;
      border-radius: 999px;
      border: 1px solid transparent;
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      text-decoration: none;
      transition: background 0.15s ease,
                  color 0.15s ease,
                  border-color 0.15s ease,
                  transform 0.08s ease,
                  box-shadow 0.12s ease;
    }

    .btn-primary {
      background: linear-gradient(135deg, #38bdf8, #0ea5e9);
      color: #0b1120;
      box-shadow: 0 12px 24px rgba(14, 165, 233, 0.55);
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 16px 32px rgba(14, 165, 233, 0.7);
    }

    .btn-ghost {
      background: transparent;
      color: #e5e7eb;
      border-color: #4b5563;
    }

    .btn-ghost:hover {
      background: rgba(15, 23, 42, 0.8);
    }

    /* Sidebar contact & LinkedIn */

    .sidebar-contact {
      font-size: 11px;
      color: var(--text-muted);
      line-height: 1.5;
    }

    .sidebar-contact a {
      color: inherit;
      text-decoration: none;
    }

    .sidebar-contact a:hover {
      text-decoration: underline;
    }

    .linkedin-card {
      margin-top: 4px;
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 9px 10px;
      border-radius: 14px;
      border: 1px solid #1f2937;
      background:
        radial-gradient(circle at top left, rgba(15, 23, 42, 0.85), #020617 70%);
      cursor: pointer;
      text-decoration: none;
      color: var(--text-main);
      font-size: 12px;
      position: relative;
      overflow: hidden;
    }

    .linkedin-card::before {
      content: "";
      position: absolute;
      inset: 0;
      opacity: 0.18;
      background:
        radial-gradient(circle at top left, #0ea5e9 0, transparent 45%),
        radial-gradient(circle at bottom right, #6366f1 0, transparent 55%);
      pointer-events: none;
    }

    .linkedin-logo {
      width: 22px;
      height: 22px;
      border-radius: 6px;
      background: #0a66c2;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #ffffff;
      font-size: 13px;
      font-weight: 700;
      flex-shrink: 0;
      box-shadow: 0 6px 12px rgba(10, 102, 194, 0.6);
      position: relative;
      z-index: 1;
    }

    .linkedin-text-main {
      font-weight: 500;
      position: relative;
      z-index: 1;
    }

    .linkedin-text-sub {
      font-size: 11px;
      color: var(--text-muted);
      position: relative;
      z-index: 1;
    }

    /* Main column */

    .main {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .top-bar {
      display: flex;
      justify-content: flex-end;
      margin-bottom: 6px;
      font-size: 11px;
      color: var(--text-muted);
      gap: 10px;
      align-items: center;
    }

    .lang-switch {
      display: inline-flex;
      border-radius: 999px;
      border: 1px solid #4b5563;
      overflow: hidden;
      background: rgba(15, 23, 42, 0.85);
      box-shadow: 0 10px 18px rgba(0, 0, 0, 0.4);
    }

    .lang-btn {
      border: none;
      background: transparent;
      padding: 4px 10px;
      font-size: 11px;
      cursor: pointer;
      color: var(--text-muted);
    }

    .lang-btn.active {
      background: rgba(15, 23, 42, 1);
      color: #e5e7eb;
      font-weight: 500;
    }

    /* Hero */

    .hero-card {
      background:
        radial-gradient(circle at 0% 0%, #38bdf8 0, transparent 50%),
        radial-gradient(circle at 100% 0%, #6366f1 0, transparent 55%),
        linear-gradient(135deg, #020617, #020617);
      border-radius: var(--radius-lg);
      border: 1px solid rgba(148, 163, 184, 0.45);
      box-shadow: var(--shadow-soft);
      padding: 20px 22px 18px;
      position: relative;
      overflow: hidden;
    }

    .hero-card::before {
      content: "";
      position: absolute;
      inset: -40px;
      opacity: 0.16;
      background:
        repeating-linear-gradient(
          90deg,
          rgba(148, 163, 184, 0.2) 0,
          rgba(148, 163, 184, 0.2) 1px,
          transparent 1px,
          transparent 7px
        );
      mix-blend-mode: screen;
      pointer-events: none;
    }

    .hero-eyebrow {
      font-size: 10px;
      letter-spacing: 0.22em;
      text-transform: uppercase;
      color: #cbd5f5;
      margin-bottom: 8px;
    }

    .hero-title {
      margin: 0 0 4px;
      font-size: 20px;
      font-weight: 600;
      color: #f9fafb;
    }

    .hero-sub {
      margin: 0;
      font-size: 13px;
      color: var(--text-muted);
      line-height: 1.6;
      max-width: 640px;
    }

    .hero-tags {
      margin-top: 12px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .hero-tag {
      font-size: 11px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.6);
      color: #e5e7eb;
      cursor: pointer;
      backdrop-filter: blur(6px);
      transition: background 0.15s ease,
                  border-color 0.15s ease,
                  transform 0.08s ease,
                  box-shadow 0.12s ease;
    }

    .hero-tag:hover {
      background: rgba(15, 23, 42, 0.9);
      border-color: var(--accent);
      transform: translateY(-0.5px);
      box-shadow: 0 10px 18px rgba(15, 23, 42, 0.7);
    }

    /* Q&A card */

    .qa-card {
      background: rgba(15, 23, 42, 0.98);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-subtle);
      box-shadow: 0 18px 36px rgba(0, 0, 0, 0.55);
      padding: 20px 22px 22px;
    }

    .qa-header-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 16px;
      margin-bottom: 14px;
    }

    .qa-title {
      margin: 0;
      font-size: 15px;
      font-weight: 600;
    }

    .qa-caption {
      margin: 0;
      font-size: 12px;
      color: var(--text-muted);
    }

    .qa-form {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 6px;
    }

    .qa-row {
      display: flex;
      gap: 10px;
    }

    @media (max-width: 600px) {
      .qa-row {
        flex-direction: column;
        align-items: stretch;
      }
    }

    textarea {
      width: 100%;
      min-height: 70px;
      resize: vertical;
      padding: 10px 11px;
      border-radius: 10px;
      border: 1px solid #374151;
      font-family: inherit;
      font-size: 13px;
      line-height: 1.5;
      outline: none;
      background: #020617;
      color: #e5e7eb;
      transition: border-color 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
    }

    textarea::placeholder {
      color: #6b7280;
    }

    textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.35);
      background: #020617;
    }

    .qa-submit-btn {
      padding-inline: 18px;
      white-space: nowrap;
      height: 38px;
    }

    .status-text {
      font-size: 12px;
      color: var(--text-muted);
      min-height: 18px;
    }

    .answer-box {
      margin-top: 8px;
      padding: 12px 12px 10px;
      border-radius: 10px;
      border: 1px solid #374151;
      background: #020617;
      font-size: 13px;
      line-height: 1.55;
      white-space: pre-wrap;
      color: #e5e7eb;
    }

    .answer-empty {
      border-style: dashed;
      background: rgba(2, 6, 23, 0.7);
      color: #6b7280;
    }

    .followup-container {
      margin-top: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: flex-start;
    }

    .followup-label {
      font-size: 11px;
      color: var(--text-muted);
      margin-right: 2px;
    }

    .followup-btn {
      font-size: 11px;
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px solid #4b5563;
      background: #020617;
      cursor: pointer;
      max-width: 100%;
      white-space: normal;
      line-height: 1.4;
      text-align: left;
      transition: background 0.15s ease,
                  border-color 0.15s ease,
                  transform 0.08s ease;
      color: #e5e7eb;
    }

    .followup-btn:hover {
      background: #020617;
      border-color: var(--accent);
      transform: translateY(-0.5px);
    }

    .footer-note {
      font-size: 11px;
      color: var(--text-muted);
      line-height: 1.5;
    }

    .footer-note strong {
      font-weight: 600;
    }
  </style>
</head>
<body>
  <main class="page">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="name-block">
        <div class="avatar">S</div>
        <div class="name-texts">
          <h1>SAMUEL CISCATO</h1>
          <div class="role" id="role-line">
            DIRECTION MARKETING ET E-COMMERCE · TRANSFORMATION DIGITALE
          </div>
          <div class="badge-twin">
            <span class="badge-dot"></span>
            <span id="badge-text">Samuel CV Twin</span>
          </div>
        </div>
      </div>

      <section>
        <h2 class="sidebar-section-title" id="profil-title">PROFIL</h2>
        <p class="sidebar-text" id="profil-text">
          Samuel clarifie des situations complexes pour les traduire en plans de croissance lisibles et utiles pour les équipes.
          Il croise marketing, digital et psychologie cognitive pour aligner clients, opérations et direction sur les mêmes priorités.
        </p>
      </section>

      <section>
        <h2 class="sidebar-section-title" id="linkedin-title">LINKEDIN</h2>
        <a
          href="https://linkedin.com/in/samuelciscato"
          target="_blank"
          rel="noreferrer"
          class="linkedin-card"
          id="linkedin-card"
        >
          <div class="linkedin-logo">in</div>
          <div>
            <div class="linkedin-text-main" id="linkedin-main-text">Voir le profil LinkedIn</div>
            <div class="linkedin-text-sub" id="linkedin-sub-text">
              Recommandations et détail complet des expériences sur LinkedIn.
            </div>
          </div>
        </a>
      </section>

      <section>
        <h2 class="sidebar-section-title" id="cv-title">CV</h2>
        <div class="sidebar-card">
          <div class="cv-preview-box" id="cv-preview">
            Aperçu CV<br />
            <span style="font-size: 11px;">(remplacez cette zone par une miniature du CV)</span>
          </div>
          <div class="sidebar-buttons">
            <a href="#" class="btn btn-primary" id="btn-download-cv">Télécharger le CV</a>
            <a href="#" class="btn btn-ghost" id="btn-open-cv">Ouvrir en grand format</a>
          </div>
        </div>
      </section>

      <section>
        <h2 class="sidebar-section-title" id="contact-title">CONTACT</h2>
        <p class="sidebar-contact">
          <span id="contact-email">samuel.ciscato@gmail.com</span><br />
          <span id="contact-phone">+33&nbsp;6&nbsp;67&nbsp;98&nbsp;00&nbsp;44</span><br />
          <span id="contact-city">Lyon, France</span><br />
        </p>
      </section>
    </aside>

    <!-- Main column -->
    <section class="main">
      <div class="top-bar">
        <span id="lang-label">Langue</span>
        <div class="lang-switch">
          <button class="lang-btn active" data-lang="fr" id="btn-lang-fr">FR</button>
          <button class="lang-btn" data-lang="en" id="btn-lang-en">EN</button>
        </div>
      </div>

      <section class="hero-card">
        <div class="hero-eyebrow" id="hero-eyebrow">DOSSIER INTERACTIF</div>
        <h2 class="hero-title" id="hero-title">
          Explorer mon parcours avant d’échanger en direct
        </h2>
        <p class="hero-sub" id="hero-sub">
          Cet outil vous permet de poser des questions à un agent IA entraîné sur mon dossier
          (CV, lettres, profil AssessFirst, questions-réponses). Il ne parle pas en mon nom&nbsp;:
          il lit, recoupe et synthétise les informations disponibles, puis vous propose des pistes pour creuser.
        </p>
        <div class="hero-tags">
          <button class="hero-tag" id="tag-1"></button>
          <button class="hero-tag" id="tag-2"></button>
          <button class="hero-tag" id="tag-3"></button>
        </div>
      </section>

      <section class="qa-card">
        <div class="qa-header-row">
          <h3 class="qa-title" id="qa-title">Poser une question à mon dossier</h3>
          <p class="qa-caption" id="qa-caption">
            L’agent s’appuie uniquement sur les informations présentes dans le dossier.
            Si une information n’y apparaît pas, il indique simplement qu’il ne sait pas.
          </p>
        </div>

        <form id="qa-form" class="qa-form">
          <div class="qa-row">
            <textarea
              id="question-input"
              name="question"
              placeholder="Par exemple : Quels résultats concrets a-t-il obtenus chez Lyca&nbsp;?"
            ></textarea>
            <button id="submit-btn" class="btn btn-primary qa-submit-btn" type="submit">
              Poser la question
            </button>
          </div>
          <div class="status-text" id="status-text"></div>
        </form>

        <div id="answer-box" class="answer-box answer-empty">
          Aucune question posée pour le moment. La première réponse apparaîtra ici.
        </div>

        <div id="followup-container" class="followup-container" style="display:none;">
          <span class="followup-label" id="followup-label">Questions possibles pour creuser&nbsp;:</span>
          <!-- boutons dynamiques ici -->
        </div>
      </section>

      <section>
        <p class="footer-note" id="footer-note">
          <strong>Données et confidentialité.</strong> Les questions posées peuvent être enregistrées
          afin d’améliorer la qualité des réponses du jumeau IA. Elles ne sont ni revendues,
          ni utilisées pour de la publicité ciblée.<br />
          <strong>Ce que l’outil ne fait pas.</strong> Il ne crée pas d’informations nouvelles
          sur la vie privée de Samuel et ne porte pas de jugement sur le fit culturel.
          Pour cela, un échange direct reste indispensable.
        </p>
      </section>
    </section>
  </main>

  <script>
    // Traductions FR / EN
    const translations = {
      fr: {
        roleLine: "DIRECTION MARKETING ET E-COMMERCE · TRANSFORMATION DIGITALE",
        badgeText: "Samuel CV Twin",
        profilTitle: "PROFIL",
        profilText:
          "Samuel clarifie des situations complexes pour les traduire en plans de croissance lisibles et utiles pour les équipes. " +
          "Il croise marketing, digital et psychologie cognitive pour aligner clients, opérations et direction sur les mêmes priorités.",
        linkedinTitle: "LINKEDIN",
        cvTitle: "CV",
        cvPreview:
          "Aperçu CV<br /><span style=\"font-size: 11px;\">(remplacez cette zone par une miniature du CV)</span>",
        btnDownload: "Télécharger le CV",
        btnOpen: "Ouvrir en grand format",
        contactTitle: "CONTACT",
        linkedinMain: "Voir le profil LinkedIn",
        linkedinSub: "Recommandations et détail complet des expériences sur LinkedIn.",
        langLabel: "Langue",
        heroEyebrow: "DOSSIER INTERACTIF",
        heroTitle: "Explorer mon parcours avant d’échanger en direct",
        heroSub:
          "Cet outil vous permet de poser des questions à un agent IA entraîné sur mon dossier " +
          "(CV, lettres, profil AssessFirst, questions-réponses). Il ne parle pas en mon nom\u00a0: " +
          "il lit, recoupe et synthétise les informations disponibles, puis vous propose des pistes pour creuser.",
        // Tags = questions rapides
        pre1Label: "Résultats marketing & e-commerce",
        pre1Question: "Quels résultats concrets Samuel a-t-il obtenus sur la partie marketing et e-commerce ?",
        pre2Label: "Management & leadership",
        pre2Question: "Comment Samuel gère-t-il une équipe marketing sous pression ou en transformation ?",
        pre3Label: "IA & automatisation",
        pre3Question: "Quels types de projets d’IA et d’automatisation Samuel a-t-il déjà pilotés ?",
        qaTitle: "Poser une question à mon dossier",
        qaCaption:
          "L’agent s’appuie uniquement sur les informations présentes dans le dossier. " +
          "Si une information n’y apparaît pas, il indique simplement qu’il ne sait pas.",
        placeholder:
          "Par exemple : Quels résultats concrets a-t-il obtenus chez Lyca\u00a0? " +
          "Ou comment gère-t-il une équipe marketing sous pression\u00a0?",
        btnAsk: "Poser la question",
        answerEmpty: "Aucune question posée pour le moment. La première réponse apparaîtra ici.",
        followupLabel: "Questions possibles pour creuser :",
        footer:
          "<strong>Données et confidentialité.</strong> Les questions posées peuvent être enregistrées " +
          "afin d’améliorer la qualité des réponses du jumeau IA. Elles ne sont ni revendues, " +
          "ni utilisées pour de la publicité ciblée.<br />" +
          "<strong>Ce que l’outil ne fait pas.</strong> Il ne crée pas d’informations nouvelles " +
          "sur la vie privée de Samuel et ne porte pas de jugement sur le fit culturel. " +
          "Pour cela, un échange direct reste indispensable.",
        loading: "En réflexion...",
        emptyQuestion: "Merci de saisir une question avant d’envoyer.",
        genericError: "Une erreur est survenue. Vous pouvez réessayer dans un instant."
      },
      en: {
        roleLine: "MARKETING & E-COMMERCE LEADERSHIP · DIGITAL TRANSFORMATION",
        badgeText: "Samuel CV Twin",
        profilTitle: "PROFILE",
        profilText:
          "Samuel designs growth systems that are readable, useful and sustainable for teams. " +
          "He combines marketing, digital and cognitive psychology to align customers, operations and leadership on the same priorities.",
        linkedinTitle: "LINKEDIN",
        cvTitle: "CV",
        cvPreview:
          "CV preview<br /><span style=\"font-size: 11px;\">(replace this area with a CV thumbnail)</span>",
        btnDownload: "Download CV",
        btnOpen: "Open full version",
        contactTitle: "CONTACT",
        linkedinMain: "View LinkedIn profile",
        linkedinSub: "Recommendations and full experience details on LinkedIn.",
        langLabel: "Language",
        heroEyebrow: "INTERACTIVE DOSSIER",
        heroTitle: "Explore my track record before a live conversation",
        heroSub:
          "This tool lets you ask questions to an AI agent trained on my dossier " +
          "(CV, letters, AssessFirst profile, Q&A blocks). It does not speak in my name\u00a0: " +
          "it reads, cross-checks and synthesises the information, then suggests angles to dig deeper.",
        pre1Label: "Marketing & e-commerce impact",
        pre1Question: "What concrete marketing and e-commerce results has Samuel delivered recently?",
        pre2Label: "Team leadership",
        pre2Question: "How does Samuel lead and support a marketing team in demanding contexts?",
        pre3Label: "AI & automation projects",
        pre3Question: "What kind of AI and marketing automation projects has Samuel already run?",
        qaTitle: "Ask a question to my dossier",
        qaCaption:
          "The agent only relies on what is present in the dossier. " +
          "If a piece of information is not there, it simply says it does not know.",
        placeholder:
          "For example: What concrete results did he deliver at Lyca? " +
          "Or how does he handle a marketing team under pressure?",
        btnAsk: "Ask the question",
        answerEmpty: "No question asked yet. The first answer will appear here.",
        followupLabel: "Follow-up questions you could ask:",
        footer:
          "<strong>Data and privacy.</strong> Questions may be logged in order to improve the quality " +
          "of the AI twin answers. They are not sold or used for targeted advertising.<br />" +
          "<strong>What this tool does not do.</strong> It does not create new information about Samuel’s private life " +
          "and it does not judge cultural fit. A direct conversation is still required for that.",
        loading: "Thinking...",
        emptyQuestion: "Please type a question before sending.",
        genericError: "Something went wrong. You can try again in a moment."
      }
    };

    const elements = {
      roleLine: document.getElementById("role-line"),
      badgeText: document.getElementById("badge-text"),
      profilTitle: document.getElementById("profil-title"),
      profilText: document.getElementById("profil-text"),
      linkedinTitle: document.getElementById("linkedin-title"),
      cvTitle: document.getElementById("cv-title"),
      cvPreview: document.getElementById("cv-preview"),
      btnDownload: document.getElementById("btn-download-cv"),
      btnOpen: document.getElementById("btn-open-cv"),
      contactTitle: document.getElementById("contact-title"),
      linkedinMain: document.getElementById("linkedin-main-text"),
      linkedinSub: document.getElementById("linkedin-sub-text"),
      langLabel: document.getElementById("lang-label"),
      heroEyebrow: document.getElementById("hero-eyebrow"),
      heroTitle: document.getElementById("hero-title"),
      heroSub: document.getElementById("hero-sub"),
      tag1: document.getElementById("tag-1"),
      tag2: document.getElementById("tag-2"),
      tag3: document.getElementById("tag-3"),
      qaTitle: document.getElementById("qa-title"),
      qaCaption: document.getElementById("qa-caption"),
      questionInput: document.getElementById("question-input"),
      submitBtn: document.getElementById("submit-btn"),
      answerBox: document.getElementById("answer-box"),
      followupLabel: document.getElementById("followup-label"),
      footerNote: document.getElementById("footer-note")
    };

    const statusText = document.getElementById("status-text");
    const followupContainer = document.getElementById("followup-container");

    const langButtons = {
      fr: document.getElementById("btn-lang-fr"),
      en: document.getElementById("btn-lang-en")
    };

    let currentLang = "fr";

    function applyLang(lang) {
      const t = translations[lang];
      if (!t) return;

      currentLang = lang;
      localStorage.setItem("cv_twin_lang", lang);

      elements.roleLine.textContent = t.roleLine;
      elements.badgeText.textContent = t.badgeText;
      elements.profilTitle.textContent = t.profilTitle;
      elements.profilText.textContent = t.profilText;
      elements.linkedinTitle.textContent = t.linkedinTitle;
      elements.cvTitle.textContent = t.cvTitle;
      elements.cvPreview.innerHTML = t.cvPreview;
      elements.btnDownload.textContent = t.btnDownload;
      elements.btnOpen.textContent = t.btnOpen;
      elements.contactTitle.textContent = t.contactTitle;
      elements.linkedinMain.textContent = t.linkedinMain;
      elements.linkedinSub.textContent = t.linkedinSub;
      elements.langLabel.textContent = t.langLabel;
      elements.heroEyebrow.textContent = t.heroEyebrow;
      elements.heroTitle.textContent = t.heroTitle;
      elements.heroSub.textContent = t.heroSub;

      elements.tag1.textContent = t.pre1Label;
      elements.tag1.dataset.question = t.pre1Question;
      elements.tag2.textContent = t.pre2Label;
      elements.tag2.dataset.question = t.pre2Question;
      elements.tag3.textContent = t.pre3Label;
      elements.tag3.dataset.question = t.pre3Question;

      elements.qaTitle.textContent = t.qaTitle;
      elements.qaCaption.textContent = t.qaCaption;
      elements.questionInput.placeholder = t.placeholder;
      elements.submitBtn.textContent = t.btnAsk;
      elements.answerBox.textContent = t.answerEmpty;
      elements.answerBox.classList.add("answer-empty");
      elements.followupLabel.textContent = t.followupLabel;
      elements.footerNote.innerHTML = t.footer;

      Object.keys(langButtons).forEach(code => {
        langButtons[code].classList.toggle("active", code === lang);
      });

      statusText.textContent = "";
      clearFollowups();
    }

    function initLang() {
      const stored = localStorage.getItem("cv_twin_lang");
      if (stored && translations[stored]) {
        applyLang(stored);
      } else {
        const navLang = (navigator.language || "en").toLowerCase();
        const defaultLang = navLang.startsWith("fr") ? "fr" : "en";
        applyLang(defaultLang);
      }
    }

    Object.keys(langButtons).forEach(code => {
      langButtons[code].addEventListener("click", () => applyLang(code));
    });

    // Geo function: Lyon vs Paris
    async function initCity() {
      try {
        const res = await fetch("/.netlify/functions/geo");
        if (!res.ok) return;
        const data = await res.json();
        const city = (data.city || "").toLowerCase();
        const contactCity = document.getElementById("contact-city");
        if (!contactCity) return;

        if (city.includes("lyon")) {
          contactCity.textContent = "Lyon, France";
        } else {
          contactCity.textContent = "Paris, France";
        }
      } catch (e) {
        // fallback: keep default value
      }
    }

    // Chat logic
    const form = document.getElementById("qa-form");

    function setLoading(isLoading) {
      const t = translations[currentLang];
      if (isLoading) {
        statusText.textContent = t.loading;
        elements.submitBtn.disabled = true;
        elements.submitBtn.textContent = t.loading;
      } else {
        statusText.textContent = "";
        elements.submitBtn.disabled = false;
        elements.submitBtn.textContent = t.btnAsk;
      }
    }

    function renderAnswer(text) {
      elements.answerBox.classList.remove("answer-empty");
      elements.answerBox.textContent = text;
    }

    function clearFollowups() {
      followupContainer.style.display = "none";
      followupContainer.querySelectorAll(".followup-btn").forEach((btn) => btn.remove());
    }

    // Parse la ligne QUESTIONS_SUIVANTES: ["...", "...", "..."]
    function parseSuggestions(rawText) {
      const match = rawText.match(/QUESTIONS_SUIVANTES:\s*(\[.*\])\s*$/m);
      if (!match) return { mainAnswer: rawText.trim(), suggestions: [] };

      let suggestions = [];
      try {
        suggestions = JSON.parse(match[1]);
      } catch (e) {
        console.error("Impossible de parser QUESTIONS_SUIVANTES", e);
      }

      const mainAnswer = rawText.replace(match[0], "").trim();
      return { mainAnswer, suggestions };
    }

    function renderFollowups(suggestions) {
      clearFollowups();
      if (!Array.isArray(suggestions) || suggestions.length === 0) return;

      followupContainer.style.display = "flex";

      suggestions.slice(0, 3).forEach((q) => {
        if (!q || typeof q !== "string") return;

        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "followup-btn";

        const label =
          q.length > 80
            ? q.slice(0, 77).trimEnd() + "..."
            : q;

        btn.textContent = label;
        btn.title = q;

        btn.addEventListener("click", () => {
          elements.questionInput.value = q;
          sendQuestion(q);
        });

        followupContainer.appendChild(btn);
      });
    }

    async function sendQuestion(question) {
      const t = translations[currentLang];

      const trimmed = (question || "").trim();
      if (!trimmed) {
        statusText.textContent = t.emptyQuestion;
        return;
      }

      elements.questionInput.value = trimmed;
      setLoading(true);
      clearFollowups();

      try {
        const response = await fetch("/.netlify/functions/chat", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ question: trimmed })
        });

        const data = await response.json();
        if (data && typeof data.answer === "string") {
          const { mainAnswer, suggestions } = parseSuggestions(data.answer);
          renderAnswer(mainAnswer);
          renderFollowups(suggestions);
        } else {
          renderAnswer(t.genericError);
        }
      } catch (error) {
        console.error(error);
        renderAnswer(translations[currentLang].genericError);
      } finally {
        setLoading(false);
      }
    }

    form.addEventListener("submit", async (event) => {
      event.preventDefault();
      const question = elements.questionInput.value;
      sendQuestion(question);
    });

    // Tags = questions rapides
    [elements.tag1, elements.tag2, elements.tag3].forEach((tagBtn) => {
      tagBtn.addEventListener("click", () => {
        const q = tagBtn.dataset.question || "";
        if (!q) return;
        sendQuestion(q);
      });
    });

    // Init
    initLang();
    initCity();
  </script>
</body>
</html>
